game.PlayerEntity=me.ObjectEntity.extend({init:function(a,b,c){c.spritewidth=220,c.spriteheight=220,this.parent(a,b,c),this.renderable.anim={},this.renderable.addAnimation("walk",[0,1,2,3,4,5]),this.renderable.addAnimation("attack",[8,6,7]),this.renderable.addAnimation("jump",[9]),this.renderable.addAnimation("die",[10,11,12,13,14,16,17,18]),this.renderable.setCurrentAnimation("walk"),this.setVelocity(.5,1),this.setFriction(.25,0),this.setMaxVelocity(5,15),this.gravity=.5,this.updateColRect(80,60,90,52),this.attacking=!1,this.alwaysUpdate=!0,this.dying=!1,this.facing=1,this.vppos=new me.Vector2d(a,b),this.spawnPosition=new me.Vector2d(a,b),this.deathTimer=0,this.gameOver=!1,me.game.viewport.follow(this.vppos,me.game.viewport.AXIS.BOTH),me.game.viewport.setDeadzone(50,150)},update:function(){if(!this.gameOver){this.vppos.x=this.pos.x+this.renderable.hWidth,this.vppos.y=this.pos.y+this.renderable.hHeight,this.dying||(me.input.isKeyPressed("left")?(this.flipX(!0),this.facing=-1,this.vel.x-=this.accel.x*me.timer.tick):me.input.isKeyPressed("right")&&(this.flipX(!1),this.facing=1,this.vel.x+=this.accel.x*me.timer.tick),me.input.isKeyPressed("jump")&&(this.jumping||this.falling||(this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0)),!this.jumping&&!this.falling||this.attacking?this.renderable.isCurrentAnimation("walk")||this.attacking||this.renderable.setCurrentAnimation("walk"):this.renderable.setCurrentAnimation("jump")),this.updateMovement(),this.pos.y+100>me.game.currentLevel.rows*me.game.currentLevel.tileheight&&!this.dying&&(this.vel.y=-this.maxVel.y,this.vel.x=0,this.die()),this.attacking&&this.updateColRect(40,140,90,52);{me.game.collide(this)}if(this.updateColRect(90,40,90,52),this.dying&&7==this.renderable.anim.die.idx&&(this.renderable.animationpause=!0,this.deathTimer-=me.timer.tick,this.deathTimer<=0)){if(0==game.data.lives)return this.gameOver=!0,me.state.change(me.state.MENU),void 0;me.game.viewport.fadeIn("#000000",500,this.reset.bind(this))}return 0!=this.vel.x||0!=this.vel.y||this.attacking||this.dying?(this.parent(),!0):!1}},die:function(){this.dying||(this.dying=!0,this.renderable.setCurrentAnimation("die"),this.renderable.setAnimationFrame(0),this.deathTimer=100)},reset:function(){this.pos.x=this.spawnPosition.x,this.pos.y=this.spawnPosition.y,this.dying=!1,this.attacking=!1,this.falling=!1,this.jumping=!1,this.deathTimer=0,this.renderable.animationpause=!1,this.renderable.setCurrentAnimation("walk"),this.renderable.setAnimationFrame(0),this.setVelocity(.5,1),this.setFriction(.25,0),this.setMaxVelocity(5,15)}});